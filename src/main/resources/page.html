<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>JS Bin</title>
    <link rel="stylesheet" href="https://rawgithub.com/yesmeck/jquery-jsonview/master/dist/jquery.jsonview.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="https://rawgithub.com/yesmeck/jquery-jsonview/master/dist/jquery.jsonview.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <script src="http://code.highcharts.com/highcharts-more.js"></script>
</head>
<body>
<br/>
<button id="collapse-btn">Collapse</button>
<button id="expand-btn">Expand</button>
<button id="toggle-btn">Toggle</button>
<button id="toggle-level1-btn">Toggle level1</button>
<button id="toggle-level2-btn">Toggle level2</button>

<div id="metadata"></div>
<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<script>
var metadata = ${metadata}

    $(function() {
    $('#metadata').JSONView(metadata);

    $('#collapse-btn').on('click', function() {
    $('#metadata').JSONView('collapse');
    });

    $('#expand-btn').on('click', function() {
    $('#metadata').JSONView('expand');
    });

    $('#toggle-btn').on('click', function() {
    $('#metadata').JSONView('toggle');
    });

    $('#toggle-level1-btn').on('click', function() {
    $('#metadata').JSONView('toggle', 1);
    });

    $('#toggle-level2-btn').on('click', function() {
    $('#metadata').JSONView('toggle', 2);
    });
    });

var data = ${data}

function zip(arrays) {
    return arrays[0].map(function(_,i){
        return arrays.map(function(array){return array[i]})
    });
}

var xy = zip([data.x, data.y]);

var err = zip([data.x, data.yErrLow, data.yErrHigh]);

console.log(xy.toString());
console.log(err.toString());

$(function () {
    $('#container').highcharts({
        chart: {
            type: 'line'
        },
        title: {
            text: 'Spectrum'
        },
        subtitle: {
            text: data.target
        },
        tooltip: {
            crosshairs: [true, true],
            formatter: function() {
                return '<b>'+data.target+'</b><br/> <b>x:</b> '
                + this.x.toExponential() + ' '
                +data.xUnits+'<br/><b>y:</b> ' + this.y.toExponential()+' '+data.yUnits;
            }
        },
        xAxis: {
            type: "linear",
            title: {
                text: 'Spectral Axis ('+data.xUnits+')'
            },
            labels: {
                formatter : function() {
                    return this.value.toExponential();
                }
            },
        },
        yAxis: {
            title: {
                text: 'FluxAxis ('+data.yUnits+')'
            },
            labels: {
                formatter : function() {
                    return this.value.toExponential();
                }
            }
        },

        plotOptions: {
            spline: {
                marker: {
                    enabled: true
                }
            }
        },

        series: [{
            data: xy
        },
            {
            name: 'Error',
            type: 'errorbar',
            data: err,
            tooltip: {
                pointFormat: '(error range: {point.low}-{point.high})<br/>'
            }
        },
        ]
    });
});

</script>
</body>
</html>